import time

# Sistema de casa de cambio Express Exchange


# Declaracion de variables

solicito = int
numero_empleado = int
dolares = float
quiere = float
pago = float
pesos = float
cambio = float
quedar = float
cantidad = float
programa = int
fecha = str
compra_tdc = 1
venta_tdc = 0
dolares_caja = float
pesos_caja = float
movimiento = 0
hora = str
controlador = 0
ganancias = 0
dar = float
pedir = float
menu_bit = True
i = 0
totales = 0
compras = 0
ventas = 0
promedio = 0
suma_ventas = 0

# Listas
v_numero_movimiento = []
v_numero_empleado = []
v_fecha = []
v_hora = []
v_tipo_movimiento = []
v_compra_tdc = []
v_venta_tdc = []
v_cantidad_dolares = []
v_dolares_caja = []
v_pesos_caja = []

# Inicio


bandera = True
while bandera:
    try:
        programa = int(input("¿Deseas utilizar el sistema?\n1]Sí\n2]No"))
        if programa == 1:
            fecha = time.strftime("%d/%m/%Y")
            hora = time.strftime("%H:%M:%S")
            bandera = True
            v_fecha.append(fecha)
            v_hora.append(hora)

            while bandera:
                try:
                    numero_empleado = int(input("Introduce el numero de empleado"))
                    bandera = False
                    v_numero_empleado.append(numero_empleado)

                    if numero_empleado <= 0:
                        bandera = True
                        print("*Captura un numero de empleado valido*")
                except ValueError:
                    print("*Captura un numero de empleado valido*")

            while compra_tdc > venta_tdc or compra_tdc == venta_tdc:
                bandera = True
                while bandera:
                    try:
                        compra_tdc = float(input("Introduce el tipo de cambio de Compra"))
                        bandera = False
                        v_compra_tdc.append(compra_tdc)

                        if compra_tdc <= 0:
                            bandera = True
                            print("*Captura un monto valido*")
                    except ValueError:
                        print("*Captura un tipo de cambio valido*")

                bandera = True
                while bandera:
                    try:
                        venta_tdc = float(input("Introduce el tipo de cambio de Venta"))
                        bandera = False
                        v_venta_tdc.append(venta_tdc)

                        if venta_tdc <= 0:
                            bandera = True
                            print("*Captura un monto valido*")
                    except ValueError:
                        print("*Captura un tipo de cambio valido*")
                if compra_tdc > venta_tdc:
                    print("*El valor de compra debe ser menor que el de venta*")
                elif compra_tdc == venta_tdc:
                    print("*El valor de venta debe ser mayor que el de compra*")

            bandera = True
            while bandera:
                try:
                    dolares_caja = float(input("Introduce la cantidad de Dolares en caja"))
                    bandera = False
                    v_dolares_caja.append(dolares_caja)

                    if dolares_caja <= 0:
                        bandera = True
                        print("*Captura un monto valido*")
                except ValueError:
                    print("*Captura un monto valido*")

            bandera = True
            while bandera:
                try:
                    pesos_caja = float(input("Introduce la cantidad de Pesos en caja"))
                    bandera = False
                    v_pesos_caja.append(pesos_caja)
                    v_numero_movimiento.append(movimiento)
                    v_tipo_movimiento.append("Inicio de operaciones")
                    v_cantidad_dolares.append("Inicio de operaciones")
                    movimiento += 1

                    if pesos_caja <= 0:
                        bandera = True
                        print("*Captura un monto valido*")
                except ValueError:
                    print("*Captura un monto valido*")

        elif programa == 2:
            print("Vuelva pronto")
            exit()
        else:
            print("*Introduce una opcion valida*")
    except ValueError:
        print("*Captura una opcion valida*")


# Metodos


def compra():
    global solicito, quiere, pago, pesos, cambio, dolares_caja, pesos_caja, compra_tdc, quedar, cantidad, movimiento, bandera, controlador
    bandera = True
    while bandera:
        try:
            solicito = int(input("\nQue solicito el cliente?\n1]Cantidad de dolares a pesos\n2]Pesos exactos\n"))
            if solicito == 1:
                bandera = True
                while bandera:
                    try:
                        quiere = int(input("\nCuantos dolares a pesos quiere?\n"))
                        bandera = True
                        while bandera:
                            try:
                                pago = int(input("\nCantidad de dolares a recibir?\n"))
                                pesos = quiere * compra_tdc
                                cambio = pago - (pesos / compra_tdc)
                                dolares_caja += quiere
                                pesos_caja -= pesos
                                print(f"\nPesos a entregar: {pesos}\nCambio: {cambio}\n")
                                bandera = False

                            except ValueError:
                                print("\n*Captura una cantidad valida*\n")
                    except ValueError:
                        print("\n*Captura una cantidad valida*\n")
            elif solicito == 2:
                bandera = True
                while bandera:
                    try:
                        quiere = int(input("\nCuantos pesos quiere?\n"))
                        bandera = True
                        while bandera:
                            try:
                                pago = int(input("\nCantidad de dolares a recibir?\n"))
                                quedar = pago * compra_tdc
                                cambio = (quedar - quiere) / compra_tdc
                                dolares_caja += pago - cambio
                                pesos_caja -= quiere
                                print(f"\nPesos a entregar: {quiere}\nCambio: {cambio}\n")
                                bandera = False

                            except ValueError:
                                print("\n*Captura una cantidad valida*\n")
                    except ValueError:
                        print("\n*Captura una cantidad valida*\n")
        except ValueError:
            print("\n*Captura una opcion valida*\n")

    if solicito == 1:
        cantidad = quiere
    elif solicito == 2:
        cantidad = pago - cambio

    controlador = 1
    registrar_bitacora()


def venta():
    global solicito, quiere, pago, pesos, cambio, dolares_caja, pesos_caja, venta_tdc, cantidad, movimiento, dolares, bandera, quedar, controlador, ganancias
    bandera = True
    while bandera:
        try:
            solicito = int(input("\nQue solicito el cliente?\n1]Cantidad de pesos a dolares\n2]Dolares exactos\n"))
            if solicito == 1:
                bandera = True
                while bandera:
                    try:
                        quiere = int(input("\nCuantos pesos a dolares quiere?\n"))
                        bandera = True
                        while bandera:
                            try:
                                pago = int(input("\nCantidad de pesos a recibir?\n"))
                                dolares = quiere / venta_tdc
                                cambio = pago - (dolares * venta_tdc)
                                print(f"\nDolares a entregar: {dolares}\nCambio: {cambio}\n")
                                dolares_caja -= dolares
                                pesos_caja += quiere
                                bandera = False

                            except ValueError:
                                print("\n*Captura una cantidad valida*\n")
                    except ValueError:
                        print("\n*Captura una cantidad valida*\n")
            elif solicito == 2:
                bandera = True
                while bandera:
                    try:
                        quiere = int(input("\nCuantos dolares quiere?\n"))
                        bandera = True
                        while bandera:
                            try:
                                pago = int(input("\nCantidad de pesos a recibir?\n"))
                                quedar = pago / venta_tdc
                                cambio = pago - (quiere * venta_tdc)
                                print(f"\nDolares a entregar: {quiere}\nCambio: {cambio}\n")
                                dolares_caja -= quiere
                                pesos_caja += (quiere * venta_tdc)
                                bandera = False

                            except ValueError:
                                print("\n*Captura una cantidad valida*\n")
                    except ValueError:
                        print("\n*Captura una cantidad valida*\n")
        except ValueError:
            print("\n*Captura una opcion valida*\n")

    ganancias += 1

    if solicito == 1:
        cantidad = dolares
    elif solicito == 2:
        cantidad = quiere

    controlador = 2
    registrar_bitacora()


def consultar_efectivo():
    global dolares_caja, pesos_caja, movimiento
    print(f"\nEfectivo en caja\nDolares: ${dolares_caja}\nPesos: ${pesos_caja}\n")


def actualizar_tc():
    global compra_tdc, venta_tdc, bandera, movimiento
    compra_tdc = 1
    venta_tdc = 0
    while compra_tdc > venta_tdc or compra_tdc == venta_tdc:
        bandera = True
        while bandera:
            try:
                compra_tdc = float(input("\nIntroduce el tipo de cambio de Compra\n"))
                bandera = False
                if compra_tdc <= 0:
                    bandera = True
                    print("\n*Captura un monto valido*\n")
            except ValueError:
                print("\n*Captura un tipo de cambio valido*\n")

        bandera = True
        while bandera:
            try:
                venta_tdc = float(input("\nIntroduce el tipo de cambio de Venta\n"))
                bandera = False
                if venta_tdc <= 0:
                    bandera = True
                    print("\n*Captura un monto valido*\n")
            except ValueError:
                print("\n*Captura un tipo de cambio valido*\n")
        if compra_tdc > venta_tdc:
            print("\n*El valor de compra debe ser menor que el de venta*\n")
        elif compra_tdc == venta_tdc:
            print("\n*El valor de venta debe ser mayor que el de compra*\n")


def actualizar_no_emp():
    global numero_empleado, bandera, movimiento
    bandera = True
    while bandera:
        try:
            numero_empleado = int(input("\nIntroduce el numero de empleado\n"))
            bandera = False
            if numero_empleado <= 0:
                bandera = True
                print("\n*Captura un numero de empleado valido*\n")
        except ValueError:
            print("\n*Captura un numero de empleado valido*\n")


def agregar_efectivo_caja():
    global dolares_caja, pesos_caja, bandera, movimiento
    bandera = True
    while bandera:
        try:
            dolares_caja += int(input("\nCantidad de dolares a agregar a caja\n"))
            bandera = False
        except ValueError:
            print("\nCaptura una cantidad valida\n")


def bitacora():
    global movimiento, numero_empleado, fecha, hora, compra_tdc, venta_tdc, dolares_caja, pesos_caja, v_numero_movimiento, v_numero_empleado, v_fecha, v_hora, v_tipo_movimiento, v_compra_tdc, v_venta_tdc, v_cantidad_dolares, v_dolares_caja, v_pesos_caja, i, menu_bit, bandera

    menu_bit = True
    while menu_bit:
        bandera = True
        while bandera:
            try:
                menu_bit = int(input(
                    "Menu Bitacora\n1]Inicio de operaciones\n2]Primer movimiento\n3]Ultimo movimiento\n4]Todos los movimientos\n5]Numero de transacciones\n6]Regresar"))
                bandera = False
            except ValueError:
                print("*Captura una opcion valida*")
        if menu_bit == 1:
            i = 0
            print(
                f"Bitacora\nNumero de movimiento: {v_numero_movimiento[i]}\nNumero de empleado: {v_numero_empleado[i]}\nFecha: {v_fecha[i]}\nHora: {v_hora[i]}\nTipo de movimiento: {v_tipo_movimiento[i]}\nTipo de cambio de compra: {v_compra_tdc[i]}\nTipo de cambio de venta: {v_venta_tdc[i]}\nCantidad del movimiento: {v_cantidad_dolares[i]}\nDolares en caja: {v_dolares_caja[i]}\nPesos en caja: {v_pesos_caja[i]}\n")
            menu_bit = True
        elif menu_bit == 2:
            i = 1
            print(
                f"Bitacora\nNumero de movimiento: {v_numero_movimiento[i]}\nNumero de empleado: {v_numero_empleado[i]}\nFecha: {v_fecha[i]}\nHora: {v_hora[i]}\nTipo de movimiento: {v_tipo_movimiento[i]}\nTipo de cambio de compra: {v_compra_tdc[i]}\nTipo de cambio de venta: {v_venta_tdc[i]}\nCantidad del movimiento: {v_cantidad_dolares[i]}\nDolares en caja: {v_dolares_caja[i]}\nPesos en caja: {v_pesos_caja[i]}\n")
            menu_bit = True
        elif menu_bit == 3:
            i = (movimiento - 1)
            print(
                f"\nBitacora\nNumero de movimiento: {v_numero_movimiento[i]}\nNumero de empleado: {v_numero_empleado[i]}\nFecha: {v_fecha[i]}\nHora: {v_hora[i]}\nTipo de movimiento: {v_tipo_movimiento[i]}\nTipo de cambio de compra: {v_compra_tdc[i]}\nTipo de cambio de venta: {v_venta_tdc[i]}\nCantidad del movimiento: {v_cantidad_dolares[i]}\nDolares en caja: {v_dolares_caja[i]}\nPesos en caja: {v_pesos_caja[i]}\n")
            menu_bit = True
        elif menu_bit == 4:
            for i in range(movimiento):
                print(
                    f"\nBitacora\nNumero de movimiento: {v_numero_movimiento[i]}\nNumero de empleado: {v_numero_empleado[i]}\nFecha: {v_fecha[i]}\nHora: {v_hora[i]}\nTipo de movimiento: {v_tipo_movimiento[i]}\nTipo de cambio de compra: {v_compra_tdc[i]}\nTipo de cambio de venta: {v_venta_tdc[i]}\nCantidad del movimiento: {v_cantidad_dolares[i]}\nDolares en caja: {v_dolares_caja[i]}\nPesos en caja: {v_pesos_caja[i]}\n")
            menu_bit = True
        elif menu_bit == 5:
            print(f"\nNumero de transacciones sin inicio de operaciones: {movimiento}")
            menu_bit = True
        elif menu_bit == 6:
            menu_bit = False
            print("\nRegresando al menu más opciones")
        else:
            print("\nIntroduce una opcion valida")


def registrar_bitacora():
    global movimiento, numero_empleado, fecha, hora, compra_tdc, venta_tdc, dolares_caja, pesos_caja, v_numero_movimiento, v_numero_empleado, v_fecha, v_hora, v_tipo_movimiento, v_compra_tdc, v_venta_tdc, v_cantidad_dolares, v_dolares_caja, v_pesos_caja

    v_numero_movimiento.append(movimiento)
    v_numero_empleado.append(numero_empleado)
    fecha = time.strftime("%d/%m/%Y")
    hora = time.strftime("%H:%M:%S")
    v_fecha.append(fecha)
    v_hora.append(hora)

    if controlador == 1:
        v_tipo_movimiento.append("Venta")
    elif controlador == 2:
        v_tipo_movimiento.append("Compra")
    v_compra_tdc.append(compra_tdc)
    v_venta_tdc.append(venta_tdc)

    if controlador == 1:
        v_cantidad_dolares.append(dar)
    elif controlador == 2:
        v_cantidad_dolares.append(pedir)

    v_dolares_caja.append(dolares_caja)
    v_pesos_caja.append(pesos_caja)

    movimiento += 1


def reporte_ventas():
    global v_tipo_movimiento, totales, compras, ventas, promedio, movimiento, fecha, ganancias, promedio, suma_ventas, v_cantidad_dolares, movimiento, numero_empleado, fecha, hora, compra_tdc, venta_tdc, dolares_caja, pesos_caja, v_numero_movimiento, v_numero_empleado, v_fecha, v_hora, v_tipo_movimiento, v_compra_tdc, v_venta_tdc, v_cantidad_dolares, v_dolares_caja, v_pesos_caja, i, menu_bit, bandera

    # Proceso
    compras = 0
    ventas = 0
    totales = 0
    suma_ventas = 0

    compras = v_tipo_movimiento.count("Compra")
    ventas = v_tipo_movimiento.count("Venta")
    totales = compras + ventas

    if ventas > 0:
        p_ventas = (ventas * 100) / totales
    else:
        p_ventas = "No hubo movimientos"
    if compras > 0:
        p_compras = (compras * 100) / totales

    else:
        p_compras = "No hubo movimientos"

    # Print
    print(
        f"\nReporte de ventas\nFecha: {fecha}\nGanancias: ${ganancias} mx\nCantidad de movimientos sin inicio de operaciones: {movimiento - 1}\nPorcentaje de ventas: {round(p_ventas)}%\nPorcentaje de compras: {round(p_compras)}%\nEfectivo sugerido al inicio de operaciones de dolares: Test \nEfectivo sugerido al inicio de operaciones de pesos: Test\n")


# Menu Principal


menu = int
while menu != 5:
    bandera = True
    while bandera:
        try:
            menu = int(input(
                f"\nExpress Exchange\n\nCompra: ${compra_tdc}   Venta: ${venta_tdc}\nNumero de empleado: {numero_empleado}\n\nMenu\n1]Compra\n2]Venta\n3]Actualizar tipo de cambio\n4]Más opciones\n5]Salir\n"))
            bandera = False
        except ValueError:
            print("\n*Captura una opcion valida*\n")
    if menu == 1:
        compra()
        menu = True

    elif menu == 2:
        venta()
        menu = True

    elif menu == 3:
        actualizar_tc()
        menu = True

    elif menu == 4:
        menu = True
        menu_2 = True
        while menu_2:
            bandera = True
            while bandera:
                try:
                    menu_2 = int(input(
                        f"\nExpress Exchange\n\nCompra: ${compra_tdc}   Venta: ${venta_tdc}\nNumero de empleado: {numero_empleado}\n\nMenu Operaciones\n1]Consultar efectivo en caja\n2]Bitacora de movimientos\n3]Reporte de ventas\n4]Actualizar numero de empleado\n5]Agregar efectivo a caja\n6]Regresar al menu anterior\n"))
                    bandera = False
                except ValueError:
                    print("\n*Captura una opcion valida*\n")
            if menu_2 == 1:
                consultar_efectivo()
                menu_2 = True
            elif menu_2 == 2:
                bitacora()
                menu_2 = True
            elif menu_2 == 3:
                reporte_ventas()
                menu_2 = True
            elif menu_2 == 4:
                actualizar_no_emp()
            elif menu_2 == 5:
                agregar_efectivo_caja()
                menu_2 = True
            elif menu_2 == 6:
                menu_2 = False
                print("\nVolviendo al menu principal\n")
            else:
                print("\n*Introduce una opcion valida*\n")

    elif menu == 5:
        print("\nGracias por utilizar el sistema\n")
    else:
        print("\n*Introduce una opcion valida*\n")
